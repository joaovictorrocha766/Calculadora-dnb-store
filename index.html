<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNB STORE | Gest√£o Oficial</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        :root {
            --bg: #0a0f1e; --card: #161e31; --primary: #3b82f6;
            --success: #22c55e; --text: #f8fafc; --purple: #8b5cf6; --danger: #ef4444; --warning: #f59e0b;
        }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); padding: 15px; display: flex; flex-direction: column; align-items: center; margin: 0; }
        .container { width: 100%; max-width: 650px; }
        
        /* Menu de Abas */
        .tabs { display: flex; gap: 5px; margin-bottom: 15px; width: 100%; overflow-x: auto; padding: 5px; scrollbar-width: none; }
        .tab-btn { flex: 1; padding: 10px; background: var(--card); border: 1px solid #2d3748; color: #94a3b8; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 0.7rem; white-space: nowrap; }
        .tab-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

        .card { background: var(--card); padding: 20px; border-radius: 16px; border: 1px solid #2d3748; margin-bottom: 15px; }
        .content-section { display: none; }
        .content-section.active { display: block; }

        /* Status Header */
        .status-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; width: 100%; }
        .status-badge { padding: 6px 12px; border-radius: 20px; font-size: 0.65rem; font-weight: bold; }
        .open { background: rgba(34, 197, 94, 0.2); color: var(--success); border: 1px solid var(--success); }
        .closed { background: rgba(239, 68, 68, 0.2); color: var(--danger); border: 1px solid var(--danger); }

        /* Alerta Estoque */
        .estoque-banner { padding: 10px; border-radius: 8px; text-align: center; font-size: 0.8rem; margin-bottom: 15px; font-weight: bold; }
        .estoque-ok { background: rgba(59, 130, 246, 0.1); color: var(--primary); border: 1px solid var(--primary); }
        .estoque-baixo { background: rgba(239, 68, 68, 0.2); color: var(--danger); border: 1px solid var(--danger); animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }

        /* Inputs */
        label { display: block; font-size: 0.75rem; color: #94a3b8; margin-bottom: 5px; }
        input, select { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #2d3748; background: #0a0f1e; color: white; margin-bottom: 15px; box-sizing: border-box; }
        
        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-success { background: var(--success); color: white; }
        .btn-purple { background: var(--purple); color: white; }
        .btn-primary { background: var(--primary); color: white; }

        /* Caixa Financeiro */
        .caixa-resumo { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; background: #1e293b; padding: 15px; border-radius: 12px; text-align: center; margin-top: 10px; }
        
        /* Tabelas */
        table { width: 100%; font-size: 0.75rem; color: #cbd5e1; border-collapse: collapse; margin-top: 10px; }
        th { text-align: left; color: #94a3b8; padding: 8px; border-bottom: 1px solid #2d3748; }
        td { padding: 8px; border-bottom: 1px solid #1a202c; }

        /* Mensagens */
        .msg-item { background: #0a0f1e; border: 1px solid #2d3748; padding: 12px; border-radius: 10px; margin-bottom: 10px; }
        .msg-item p { font-size: 0.8rem; margin: 0 0 10px 0; color: #cbd5e1; }
    </style>
</head>
<body>

<div class="container">
    <div class="status-header">
        <div style="font-weight: bold; font-size: 1.1rem;">DNB STORE üíé</div>
        <div id="statusLoja" class="status-badge">Verificando...</div>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="openTab('vendas')">üõí PDV</button>
        <button class="tab-btn" onclick="openTab('simulacao')">üßÆ SIMULA√á√ÉO</button>
        <button class="tab-btn" onclick="openTab('mensagens')">üì¢ MSGS</button>
        <button class="tab-btn" onclick="openTab('ajustes')">‚öôÔ∏è AJUSTES</button>
    </div>

    <div id="vendas" class="content-section active">
        <div id="bannerEstoque" class="estoque-banner estoque-ok">Saldo no Fornecedor: 0 Robux</div>
        
        <div class="card">
            <label>Cliente (@)</label>
            <input type="text" id="nomeCliente" placeholder="Ex: @Marcos_Roblox">
            <label>Quantidade de Robux</label>
            <input type="number" id="qtdRobux" oninput="calcPDV()">
            <div id="taxPDV" style="text-align:center; color:var(--warning); font-weight:bold; font-size:0.8rem; margin-bottom:15px;">Gamepass: 0</div>
            <button class="btn btn-success" onclick="salvarVenda()">üíæ SALVAR E COPIAR RECIBO</button>
        </div>
        
        <div class="caixa-resumo">
            <div style="grid-column: span 2; border-bottom: 1px solid #334155; padding-bottom: 8px;">
                <label>LUCRO TOTAL</label><span id="lucroAcumulado" style="font-size: 1.4rem; font-weight: bold; color: var(--success);">R$ 0,00</span>
            </div>
            <div><label>EU (50%)</label><span id="lEu" style="color:var(--primary); font-weight:bold;">R$ 0,00</span></div>
            <div><label>S√ìCIO (50%)</label><span id="lSocio" style="color:var(--primary); font-weight:bold;">R$ 0,00</span></div>
        </div>
    </div>

    <div id="simulacao" class="content-section">
        <div class="card">
            <h3>üßÆ Simulador de Pre√ßo</h3>
            <label>Quantidade desejada:</label>
            <input type="number" id="simQtd" oninput="realizarSimulacao()">
            <div style="background: #0a0f1e; padding: 15px; border-radius: 10px; font-size: 0.9rem;">
                <p>Custo Fornecedor: <span id="sCusto" style="float:right">R$ 0,00</span></p>
                <p>Pre√ßo Cliente: <span id="sVenda" style="float:right; color:var(--success); font-weight:bold;">R$ 0,00</span></p>
                <hr style="border-color: #2d3748;">
                <p>Lucro da Venda: <span id="sLucro" style="float:right">R$ 0,00</span></p>
                <p>Divis√£o (Cada): <span id="sCada" style="float:right; color:var(--primary)">R$ 0,00</span></p>
            </div>
            <button class="btn btn-purple" style="margin-top:15px;" onclick="copiarOrcamento()">üìã COPIAR OR√áAMENTO</button>
        </div>
    </div>

    <div id="mensagens" class="content-section">
        <div class="card">
            <div class="msg-item">
                <p><strong>üåô Hor√°rio Fechado:</strong> Informa que a entrega ser√° feita na abertura.</p>
                <button class="btn btn-primary" onclick="copiarMsg('fechado')">Copiar</button>
            </div>
            <div class="msg-item">
                <p><strong>‚è≥ Aguardando PIX:</strong> Cobran√ßa educada do comprovante.</p>
                <button class="btn btn-primary" onclick="copiarMsg('pix')">Copiar</button>
            </div>
            <div class="msg-item">
                <p><strong>‚è≥ Explica√ß√£o Pendente:</strong> Explica os 3-7 dias do Roblox.</p>
                <button class="btn btn-primary" onclick="copiarMsg('pendente')">Copiar</button>
            </div>
        </div>
    </div>

    <div id="ajustes" class="content-section">
        <div class="card">
            <h3>üì¶ Controle de Estoque</h3>
            <label>Saldo Atual no Fornecedor (Robux):</label>
            <input type="number" id="cfgEstoque" value="0" oninput="saveCfg()">
            <p style="font-size: 0.65rem; color: #94a3b8;">O sistema abate automaticamente a cada venda feita no PDV.</p>
        </div>

        <div class="card">
            <h3>‚öôÔ∏è Pre√ßos e Hor√°rios</h3>
            <label>Custo Unit√°rio:</label><input type="number" id="cfgCusto" value="0.0335" step="0.0001" oninput="saveCfg()">
            <label>Venda Unit√°ria:</label><input type="number" id="cfgVenda" value="0.0480" step="0.0001" oninput="saveCfg()">
            <div style="display:flex; gap:10px;">
                <div style="flex:1"><label>Abre:</label><input type="number" id="cfgAbre" value="8" oninput="saveCfg()"></div>
                <div style="flex:1"><label>Fecha:</label><input type="number" id="cfgFecha" value="22" oninput="saveCfg()"></div>
            </div>
        </div>

        <div class="card">
            <h3>üèÜ DNB Points (Fidelidade)</h3>
            <table id="tabelaFidelidade">
                <thead><tr><th>Cliente</th><th>Robux Total</th><th>Pontos</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
        
        <button class="btn btn-danger" style="background:var(--danger); color:white; font-size:0.7rem;" onclick="localStorage.clear(); location.reload();">üóëÔ∏è RESETAR SISTEMA</button>
    </div>
</div>

<script>
    function openTab(id) {
        document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    function loadCfg() {
        const c = JSON.parse(localStorage.getItem('dnb_config'));
        if(c) {
            document.getElementById('cfgCusto').value = c.custo;
            document.getElementById('cfgVenda').value = c.venda;
            document.getElementById('cfgAbre').value = c.abre;
            document.getElementById('cfgFecha').value = c.fecha;
            document.getElementById('cfgEstoque').value = c.estoque || 0;
        }
        renderFinancas();
        atualizarStatus();
        renderFidelidade();
    }

    function saveCfg() {
        const config = {
            custo: document.getElementById('cfgCusto').value,
            venda: document.getElementById('cfgVenda').value,
            abre: document.getElementById('cfgAbre').value,
            fecha: document.getElementById('cfgFecha').value,
            estoque: document.getElementById('cfgEstoque').value
        };
        localStorage.setItem('dnb_config', JSON.stringify(config));
        atualizarStatus();
        renderEstoque();
    }

    function renderEstoque() {
        const estoque = parseInt(document.getElementById('cfgEstoque').value) || 0;
        const banner = document.getElementById('bannerEstoque');
        banner.innerText = `Saldo no Fornecedor: ${estoque.toLocaleString()} Robux`;
        
        if(estoque < 1000) {
            banner.className = "estoque-banner estoque-baixo";
            banner.innerText += " (ESTOQUE BAIXO!)";
        } else {
            banner.className = "estoque-banner estoque-ok";
        }
    }

    function salvarVenda() {
        const qtd = parseFloat(document.getElementById('qtdRobux').value);
        const cli = document.getElementById('nomeCliente').value || "Cliente";
        let estoque = parseInt(document.getElementById('cfgEstoque').value) || 0;

        if(!qtd) return alert("Insira a quantidade!");
        if(qtd > estoque) return alert("Erro: Estoque insuficiente no fornecedor!");

        const cU = parseFloat(document.getElementById('cfgCusto').value);
        const vU = parseFloat(document.getElementById('cfgVenda').value);
        const vTot = (qtd * vU).toFixed(2);
        const lTot = (vTot - (qtd * cU)).toFixed(2);
        const prot = "DNB-" + Math.floor(Math.random() * 999999);

        // Salvar Venda
        const venda = { prot, cli, qtd, vTot, lTot, data: new Date().toLocaleDateString() };
        let db = JSON.parse(localStorage.getItem('dnb_db')) || [];
        db.unshift(venda);
        localStorage.setItem('dnb_db', JSON.stringify(db));

        // Abater Estoque
        document.getElementById('cfgEstoque').value = estoque - qtd;
        saveCfg();

        navigator.clipboard.writeText(`üíé *DNB STORE*\n\nüÜî *PROT:* ${prot}\nüë§ *CLIENTE:* ${cli}\nüì¶ *PRODUTO:* ${qtd} Robux\nüí∞ *VALOR:* R$ ${vTot}\n‚úÖ *STATUS:* CONCLU√çDO`);
        
        alert("Venda Salva! Estoque atualizado e Recibo copiado.");
        document.getElementById('qtdRobux').value = "";
        renderFinancas();
        renderFidelidade();
    }

    function renderFidelidade() {
        const db = JSON.parse(localStorage.getItem('dnb_db')) || [];
        const pontos = {};
        db.forEach(v => {
            const nome = v.cli.toLowerCase().trim();
            pontos[nome] = (pontos[nome] || 0) + parseFloat(v.qtd);
        });

        const tbody = document.querySelector("#tabelaFidelidade tbody");
        tbody.innerHTML = "";
        for (let cli in pontos) {
            const totalRobux = pontos[cli];
            const dnbPoints = Math.floor(totalRobux / 1000);
            tbody.innerHTML += `<tr><td>${cli}</td><td>${totalRobux}</td><td style="color:var(--purple); font-weight:bold;">${dnbPoints} pts</td></tr>`;
        }
    }

    function realizarSimulacao() {
        const qtd = parseFloat(document.getElementById('simQtd').value) || 0;
        const cU = parseFloat(document.getElementById('cfgCusto').value);
        const vU = parseFloat(document.getElementById('cfgVenda').value);
        const lucro = (qtd * vU) - (qtd * cU);
        document.getElementById('sCusto').innerText = `R$ ${(qtd * cU).toFixed(2)}`;
        document.getElementById('sVenda').innerText = `R$ ${(qtd * vU).toFixed(2)}`;
        document.getElementById('sLucro').innerText = `R$ ${lucro.toFixed(2)}`;
        document.getElementById('sCada').innerText = `R$ ${(lucro/2).toFixed(2)}`;
    }

    function copiarOrcamento() {
        const qtd = document.getElementById('simQtd').value;
        const valor = document.getElementById('sVenda').innerText;
        navigator.clipboard.writeText(`üíé *DNB STORE - OR√áAMENTO*\n\nüì¶ *PRODUTO:* ${qtd} Robux\nüí∞ *VALOR:* ${valor}\n\n‚úÖ *Garantia e Suporte Oficial!*`);
        alert("Or√ßamento copiado!");
    }

    function renderFinancas() {
        const db = JSON.parse(localStorage.getItem('dnb_db')) || [];
        let total = 0;
        db.forEach(v => total += parseFloat(v.lTot));
        document.getElementById('lucroAcumulado').innerText = `R$ ${total.toFixed(2)}`;
        document.getElementById('lEu').innerText = `R$ ${(total/2).toFixed(2)}`;
        document.getElementById('lSocio').innerText = `R$ ${(total/2).toFixed(2)}`;
    }

    function atualizarStatus() {
        const agora = new Date().getHours();
        const abre = parseInt(document.getElementById('cfgAbre').value);
        const fecha = parseInt(document.getElementById('cfgFecha').value);
        const status = document.getElementById('statusLoja');
        if(agora >= abre && agora < fecha) { status.innerText = "‚óè ABERTA"; status.className = "status-badge open"; }
        else { status.innerText = "‚óè FECHADA"; status.className = "status-badge closed"; }
        renderEstoque();
    }

    function calcPDV() {
        const qtd = document.getElementById('qtdRobux').value;
        document.getElementById('taxPDV').innerText = `Gamepass Sugerida: ${Math.ceil(qtd / 0.7)} Robux`;
    }

    function copiarMsg(tipo) {
        let t = ""; const abre = document.getElementById('cfgAbre').value;
        if(tipo === 'fechado') t = `üåô *DNB STORE*\n\nNosso setor de entregas est√° pausado agora. Seu pedido foi registrado e ser√° enviado prioritariamente √†s *${abre}:00h*!`;
        if(tipo === 'pix') t = `‚è≥ *DNB STORE*\n\nAguardamos o envio do comprovante para liberar seu pedido! Se tiver d√∫vidas, estou aqui.`;
        if(tipo === 'pendente') t = `‚è≥ *SOBRE O PRAZO*\n\nOs Robux ficam 'Pendentes' por *3 a 7 dias* antes de entrarem no saldo principal. Esse √© o padr√£o do Roblox!`;
        navigator.clipboard.writeText(t); alert("Copiado!");
    }

    window.onload = loadCfg;
</script>
</body>
</html>

