<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNB STORE | Gest√£o Oficial</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        :root {
            --bg: #0a0f1e; --card: #161e31; --primary: #3b82f6;
            --success: #22c55e; --text: #f8fafc; --purple: #8b5cf6; --danger: #ef4444; --warning: #f59e0b;
        }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); padding: 15px; display: flex; flex-direction: column; align-items: center; margin: 0; }
        .container { width: 100%; max-width: 650px; }
        
        .tabs { display: flex; gap: 5px; margin-bottom: 15px; width: 100%; overflow-x: auto; padding: 5px; scrollbar-width: none; }
        .tab-btn { flex: 1; padding: 10px; background: var(--card); border: 1px solid #2d3748; color: #94a3b8; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 0.7rem; white-space: nowrap; }
        .tab-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

        .card { background: var(--card); padding: 20px; border-radius: 16px; border: 1px solid #2d3748; margin-bottom: 15px; }
        .content-section { display: none; }
        .content-section.active { display: block; }

        .status-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; width: 100%; }
        .status-badge { padding: 6px 12px; border-radius: 20px; font-size: 0.65rem; font-weight: bold; }
        .open { background: rgba(34, 197, 94, 0.2); color: var(--success); border: 1px solid var(--success); }
        .closed { background: rgba(239, 68, 68, 0.2); color: var(--danger); border: 1px solid var(--danger); }

        .estoque-banner { padding: 10px; border-radius: 8px; text-align: center; font-size: 0.8rem; margin-bottom: 15px; font-weight: bold; }
        .estoque-ok { background: rgba(59, 130, 246, 0.1); color: var(--primary); border: 1px solid var(--primary); }
        .estoque-baixo { background: rgba(239, 68, 68, 0.2); color: var(--danger); border: 1px solid var(--danger); animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }

        label { display: block; font-size: 0.75rem; color: #94a3b8; margin-bottom: 5px; }
        input { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #2d3748; background: #0a0f1e; color: white; margin-bottom: 15px; box-sizing: border-box; }
        
        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 5px; }
        .btn-success { background: var(--success); color: white; }
        .btn-purple { background: var(--purple); color: white; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-danger { background: var(--danger); color: white; }

        .caixa-resumo { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; background: #1e293b; padding: 15px; border-radius: 12px; text-align: center; margin-top: 10px; }
        
        table { width: 100%; font-size: 0.75rem; color: #cbd5e1; border-collapse: collapse; margin-top: 10px; }
        th { text-align: left; color: #94a3b8; padding: 8px; border-bottom: 1px solid #2d3748; }
        td { padding: 8px; border-bottom: 1px solid #1a202c; }

        .msg-item { background: #0a0f1e; border: 1px solid #2d3748; padding: 12px; border-radius: 10px; margin-bottom: 10px; }
        .msg-item p { font-size: 0.8rem; margin: 0 0 10px 0; color: #cbd5e1; }

        #qrcode { background: white; padding: 10px; border-radius: 8px; display: inline-block; margin-top: 10px; }

        .log-vendas { max-height: 250px; overflow-y: auto; margin-top: 10px; border-top: 1px solid #2d3748; padding-top: 10px; }
        .log-item { font-size: 0.7rem; padding: 8px 0; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #1e293b; }

        .meta-container { margin-bottom: 15px; background: #1e293b; padding: 12px; border-radius: 12px; border: 1px solid #334155; }
        .meta-track { background: #0a0f1e; height: 8px; border-radius: 4px; overflow: hidden; margin-top: 8px; }
        .meta-bar { background: var(--success); height: 100%; width: 0%; transition: width 0.5s ease; }
        
        .stats-mini { display: flex; gap: 10px; margin-bottom: 15px; }
        .stat-box { flex: 1; background: rgba(59, 130, 246, 0.1); border: 1px solid var(--primary); padding: 8px; border-radius: 8px; text-align: center; font-size: 0.7rem; }
    </style>
</head>
<body>

<div class="container">
    <div class="status-header">
        <div style="font-weight: bold; font-size: 1.1rem;">DNB STORE üíé</div>
        <div id="statusLoja" class="status-badge">Verificando...</div>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="openTab('vendas')">üõí PDV</button>
        <button class="tab-btn" onclick="openTab('simulacao')">üßÆ SIMULA√á√ÉO</button>
        <button class="tab-btn" onclick="openTab('mensagens')">üì¢ MSGS</button>
        <button class="tab-btn" onclick="openTab('relatorios')">üìä RELAT√ìRIOS</button>
        <button class="tab-btn" onclick="openTab('ajustes')">‚öôÔ∏è AJUSTES</button>
    </div>

    <div id="vendas" class="content-section active">
        <div class="meta-container">
            <div style="display:flex; justify-content:space-between; font-size:0.7rem; font-weight:bold;">
                <span>üéØ META DI√ÅRIA (LUCRO)</span>
                <span id="txtMeta">R$ 0,00 / R$ 50,00</span>
            </div>
            <div class="meta-track"><div id="barraMeta" class="meta-bar"></div></div>
        </div>

        <div class="stats-mini">
            <div class="stat-box">HOJE: <br><strong id="robuxHoje">0 R$</strong></div>
            <div class="stat-box" style="border-color: var(--purple);">TOTAL: <br><strong id="robuxTotal">0 R$</strong></div>
        </div>

        <div id="bannerEstoque" class="estoque-banner estoque-ok">Saldo no Fornecedor: 0 Robux</div>
        <div class="card">
            <label>Cliente (@)</label>
            <input type="text" id="nomeCliente" placeholder="Ex: @Marcos_Roblox">
            <label>Quantidade de Robux</label>
            <input type="number" id="qtdRobux" oninput="calcPDV()">
            <div id="taxPDV" style="text-align:center; color:var(--warning); font-weight:bold; font-size:0.8rem; margin-bottom:15px;">Gamepass: 0</div>
            <button class="btn btn-success" onclick="salvarVenda()">üíæ SALVAR E COPIAR RECIBO</button>
            <button class="btn btn-primary" onclick="gerarPIX()">üì± GERAR QR CODE PIX</button>
            <div id="areaPix" style="display:none; text-align:center; margin-top:15px;">
                <div id="qrcode"></div>
                <button class="btn btn-purple" style="font-size:0.7rem; margin-top:10px;" onclick="copiarChavePix()">üìã COPIAR CHAVE PIX (PIX COPIA E COLA)</button>
            </div>
        </div>

        <div class="caixa-resumo">
            <div style="grid-column: span 2; border-bottom: 1px solid #334155; padding-bottom: 8px;">
                <label>LUCRO EM CAIXA</label><span id="lucroAcumulado" style="font-size: 1.4rem; font-weight: bold; color: var(--success);">R$ 0,00</span>
            </div>
            <div><label>EU (50%)</label><span id="lEu" style="color:var(--primary); font-weight:bold;">R$ 0,00</span></div>
            <div><label>S√ìCIO (50%)</label><span id="lSocio" style="color:var(--primary); font-weight:bold;">R$ 0,00</span></div>
            <button class="btn btn-danger" style="grid-column: span 2; font-size: 0.7rem; margin-top: 10px;" onclick="realizarRetirada()">üí∏ REALIZAR RETIRADA (ZERAR)</button>
        </div>

        <div class="card log-vendas" id="logVendas"></div>
    </div>

    <div id="simulacao" class="content-section">
        <div class="card">
            <h3>üßÆ Simulador de Venda</h3>
            <label>Quantidade de Robux:</label>
            <input type="number" id="simQtd" placeholder="Ex: 1000" oninput="realizarSimulacao()">
            <div id="resSimula" style="background: #0a0f1e; padding: 15px; border-radius: 10px; font-size: 0.9rem;">
                <p>Pre√ßo Cliente: <span id="sPrecoCli" style="float:right; color:var(--success); font-weight:bold;">R$ 0,00</span></p>
                <p>Lucro Total: <span id="sLucro" style="float:right">R$ 0,00</span></p>
                <p>Cada S√≥cio: <span id="sCada" style="float:right; color:var(--primary)">R$ 0,00</span></p>
            </div>
            
            <div id="areaTroco" style="margin-top:15px; padding:10px; border: 1px dashed var(--purple); border-radius:10px; display:none;">
                <label style="color:var(--purple); font-weight:bold;">üéÅ B√îNUS DE FIDELIDADE (TROCO)</label>
                <p style="font-size:0.75rem; margin:5px 0;">Se o cliente pagar valor redondo, ele pode ganhar:</p>
                <div id="txtTroco" style="font-weight:bold; color:var(--success); text-align:center;"></div>
            </div>

            <button class="btn btn-purple" style="margin-top:15px;" onclick="copiarOrcamento()">üìã COPIAR OR√áAMENTO</button>
        </div>
    </div>

    <div id="mensagens" class="content-section">
        <div class="card">
            <div class="msg-item"><p><strong>üìñ Tutorial de Compra</strong></p><button class="btn btn-success" onclick="copiarMsg('tutorial')">Copiar Passo-a-Passo</button></div>
            <div class="msg-item"><p><strong>üåô Hor√°rio Fechado</strong></p><button class="btn btn-primary" onclick="copiarMsg('fechado')">Copiar</button></div>
            <div class="msg-item"><p><strong>‚è≥ Aguardando PIX</strong></p><button class="btn btn-primary" onclick="copiarMsg('pix')">Copiar</button></div>
            <div class="msg-item"><p><strong>‚è≥ Explica√ß√£o Pendente</strong></p><button class="btn btn-primary" onclick="copiarMsg('pendente')">Copiar</button></div>
        </div>
    </div>

    <div id="relatorios" class="content-section">
        <div class="card">
            <h3>üìä Hist√≥rico Mensal (Permanente)</h3>
            <table id="tabelaMensal">
                <thead><tr><th>M√™s/Ano</th><th>Vendas</th><th>Lucro</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <div id="ajustes" class="content-section">
        <div class="card">
            <h3>‚öôÔ∏è Configura√ß√µes</h3>
            <label>Chave PIX:</label><input type="text" id="cfgPix" oninput="saveCfg()">
            <label>Custo (Fornecedor):</label><input type="number" id="cfgCusto" step="0.0001" oninput="saveCfg()">
            <label>Venda (Cliente):</label><input type="number" id="cfgVenda" step="0.0001" oninput="saveCfg()">
            <label>Saldo no Fornecedor:</label><input type="number" id="cfgEstoque" oninput="saveCfg()">
            <div style="display:flex; gap:10px;">
                <div style="flex:1"><label>Abre:</label><input type="number" id="cfgAbre" oninput="saveCfg()"></div>
                <div style="flex:1"><label>Fecha:</label><input type="number" id="cfgFecha" oninput="saveCfg()"></div>
            </div>
        </div>
        <div class="card">
            <h3>üèÜ Ranking de Clientes</h3>
            <input type="text" id="buscaFidelidade" placeholder="üîç Buscar cliente..." oninput="renderFidelidade()" style="margin-bottom:10px; padding: 10px; font-size: 0.8rem;">
            <table id="tabelaFidelidade">
                <thead><tr><th>Cliente</th><th>Total</th><th>Pontos</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
        <button class="btn btn-danger" style="opacity:0.5" onclick="if(confirm('Apagar tudo?')) {localStorage.clear(); location.reload();}">üóëÔ∏è RESET TOTAL</button>
    </div>
</div>

<script>
    function openTab(id) {
        document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    function saveCfg() {
        const config = {
            custo: document.getElementById('cfgCusto').value || 0.0335,
            venda: document.getElementById('cfgVenda').value || 0.0480,
            abre: document.getElementById('cfgAbre').value || 8,
            fecha: document.getElementById('cfgFecha').value || 22,
            estoque: document.getElementById('cfgEstoque').value || 0,
            pix: document.getElementById('cfgPix').value || ""
        };
        localStorage.setItem('dnb_config', JSON.stringify(config));
        atualizarStatus();
    }

    function loadCfg() {
        const c = JSON.parse(localStorage.getItem('dnb_config')) || {};
        document.getElementById('cfgCusto').value = c.custo || 0.0335;
        document.getElementById('cfgVenda').value = c.venda || 0.0480;
        document.getElementById('cfgAbre').value = c.abre || 8;
        document.getElementById('cfgFecha').value = c.fecha || 22;
        document.getElementById('cfgEstoque').value = c.estoque || 0;
        document.getElementById('cfgPix').value = c.pix || "";
        renderTudo();
    }

    function renderTudo() {
        renderFinancas();
        renderFidelidade();
        renderEstoque();
        renderMensal();
        renderLog();
        renderMetas();
    }

    function salvarVenda() {
        const qtd = parseFloat(document.getElementById('qtdRobux').value);
        const cli = document.getElementById('nomeCliente').value || "Cliente";
        let est = parseInt(document.getElementById('cfgEstoque').value);

        if(!qtd || qtd > est) return alert("Sem estoque ou valor inv√°lido!");

        const vU = parseFloat(document.getElementById('cfgVenda').value);
        const cU = parseFloat(document.getElementById('cfgCusto').value);
        const lTot = (qtd * (vU - cU)).toFixed(2);
        
        const db = JSON.parse(localStorage.getItem('dnb_db')) || [];
        // Adicionado 'entregue: false' para o novo sistema
        db.unshift({ cli, qtd, lTot, date: new Date().toISOString(), retirada: false, entregue: false });
        localStorage.setItem('dnb_db', JSON.stringify(db));

        document.getElementById('cfgEstoque').value = est - qtd;
        saveCfg();
        document.getElementById('qtdRobux').value = "";
        renderTudo();
        alert("Venda salva!");
    }

    function renderFinancas() {
        const db = JSON.parse(localStorage.getItem('dnb_db')) || [];
        let total = 0;
        db.filter(v => !v.retirada).forEach(v => total += parseFloat(v.lTot));
        document.getElementById('lucroAcumulado').innerText = `R$ ${total.toFixed(2)}`;
        document.getElementById('lEu').innerText = `R$ ${(total/2).toFixed(2)}`;
        document.getElementById('lSocio').innerText = `R$ ${(total/2).toFixed(2)}`;
    }

    function renderMetas() {
        const db = JSON.parse(localStorage.getItem('dnb_db')) || [];
        const hoje = new Date().toLocaleDateString();
        let lucroHoje = 0;
        let robuxHoje = 0;
        let robuxTotal = 0;

        db.forEach(v => {
            robuxTotal += parseFloat(v.qtd);
            if(new Date(v.date).toLocaleDateString() === hoje) {
                lucroHoje += parseFloat(v.lTot);
                robuxHoje += parseFloat(v.qtd);
            }
        });

        const meta = 50.00;
        const porc = Math.min((lucroHoje / meta) * 100, 100);
        document.getElementById('txtMeta').innerText = `R$ ${lucroHoje.toFixed(2)} / R$ ${meta.toFixed(2)}`;
        document.getElementById('barraMeta').style.width = porc + "%";
        
        // Atualiza estat√≠sticas de volume de Robux
        document.getElementById('robuxHoje').innerText = robuxHoje.toLocaleString() + " R$";
        document.getElementById('robuxTotal').innerText = robuxTotal.toLocaleString() + " R$";
    }

    function renderLog() {
        const db = JSON.parse(localStorage.getItem('dnb_db')) || [];
        const log = document.getElementById('logVendas');
        log.innerHTML = "<strong>√öltimas Vendas & Status:</strong>";
        
        db.slice(0, 8).forEach((v, index) => {
            const statusIcon = v.entregue ? "‚úÖ" : "‚è≥";
            const statusColor = v.entregue ? "var(--success)" : "var(--warning)";
            
            log.innerHTML += `
                <div class="log-item">
                    <span>${v.cli} (${v.qtd} R$)</span>
                    <span onclick="alternarEntrega(${index})" style="cursor:pointer; color:${statusColor}; font-weight:bold; font-size:0.6rem; border:1px solid ${statusColor}; padding:2px 5px; border-radius:4px;">
                        ${statusIcon} ${v.entregue ? 'ENTREGUE' : 'PENDENTE'}
                    </span>
                </div>`;
        });
    }

    function alternarEntrega(index) {
        const db = JSON.parse(localStorage.getItem('dnb_db')) || [];
        db[index].entregue = !db[index].entregue;
        localStorage.setItem('dnb_db', JSON.stringify(db));
        renderLog();
    }

    function realizarSimulacao() {
        const q = parseFloat(document.getElementById('simQtd').value) || 0;
        const vU = parseFloat(document.getElementById('cfgVenda').value);
        const cU = parseFloat(document.getElementById('cfgCusto').value);
        
        const precoCli = q * vU;
        const lucro = q * (vU - cU);
        const margem = precoCli > 0 ? (lucro / precoCli) : 0;

        document.getElementById('sPrecoCli').innerText = `R$ ${precoCli.toFixed(2)}`;
        const sLucro = document.getElementById('sLucro');
        sLucro.innerText = `R$ ${lucro.toFixed(2)}`;
        sLucro.style.color = margem < 0.10 ? 'var(--danger)' : 'var(--text)';
        document.getElementById('sCada').innerText = `R$ ${(lucro/2).toFixed(2)}`;

        const proximoRedondo = Math.ceil(precoCli);
        const trocoCentavos = proximoRedondo - precoCli;
        const robuxBonus = Math.floor(trocoCentavos / vU);

        const areaTroco = document.getElementById('areaTroco');
        if (robuxBonus >= 50) {
            areaTroco.style.display = "block";
            document.getElementById('txtTroco').innerText = `Pague R$ ${proximoRedondo.toFixed(2)} e leve +${robuxBonus} Robux!`;
        } else {
            areaTroco.style.display = "none";
        }
    }

    function renderMensal() {
        const db = JSON.parse(localStorage.getItem('dnb_db')) || [];
        const mensal = {};
        db.forEach(v => {
            const d = new Date(v.date);
            const key = `${d.getMonth()+1}/${d.getFullYear()}`;
            if(!mensal[key]) mensal[key] = { q: 0, l: 0 };
            mensal[key].q++; mensal[key].l += parseFloat(v.lTot);
        });
        const tbody = document.querySelector("#tabelaMensal tbody");
        tbody.innerHTML = "";
        for(let k in mensal) tbody.innerHTML += `<tr><td>${k}</td><td>${mensal[k].q}</td><td>R$ ${mensal[k].l.toFixed(2)}</td></tr>`;
    }

    function copiarMsg(tipo) {
        let t = "";
        if(tipo === 'tutorial') t = `üìñ *COMO COMPRAR NA DNB STORE*\n\n1Ô∏è‚É£ Eu te passo o valor da Gamepass.\n2Ô∏è‚É£ Voc√™ cria ela no seu perfil.\n3Ô∏è‚É£ Me envia o link e o comprovante PIX.\n4Ô∏è‚É£ Eu compro e os Robux caem em 3-7 dias (pendente).`;
        if(tipo === 'fechado') t = `üåô *DNB STORE FECHADA*`;
        if(tipo === 'pendente') t = `‚è≥ *AVISO*: Robux via Gamepass demoram de 3 a 7 dias para liberar.`;
        if(tipo === 'pix') t = `‚è≥ *AGUARDANDO PIX* para liberar seu pedido!`;
        navigator.clipboard.writeText(t); alert("Copiado!");
    }

    function renderEstoque() {
        const est = parseInt(document.getElementById('cfgEstoque').value) || 0;
        const b = document.getElementById('bannerEstoque');
        b.innerText = `Saldo no Fornecedor: ${est.toLocaleString()} Robux`;
        b.className = est < 1000 ? "estoque-banner estoque-baixo" : "estoque-banner estoque-ok";
    }

    function renderFidelidade() {
        const db = JSON.parse(localStorage.getItem('dnb_db')) || [];
        const busca = document.getElementById('buscaFidelidade').value.toLowerCase();
        const pts = {};
        db.forEach(v => { const n = v.cli.toLowerCase(); pts[n] = (pts[n] || 0) + parseFloat(v.qtd); });
        const tbody = document.querySelector("#tabelaFidelidade tbody");
        tbody.innerHTML = "";
        for(let n in pts) {
            if(n.includes(busca)) {
                tbody.innerHTML += `<tr><td>${n}</td><td>${pts[n]}</td><td style="color:var(--purple)">${Math.floor(pts[n]/1000)} pts</td></tr>`;
            }
        }
    }

    function realizarRetirada() {
        const db = JSON.parse(localStorage.getItem('dnb_db')) || [];
        if(db.length === 0) return alert("O caixa j√° est√° zerado!");
        if(confirm("Confirmar retirada de lucros?")) {
            const novoDb = db.map(v => ({...v, retirada: true}));
            localStorage.setItem('dnb_db', JSON.stringify(novoDb));
            renderTudo();
            alert("Retirada realizada!");
        }
    }

    function copiarChavePix() {
        const c = document.getElementById('cfgPix').value;
        if(!c) return alert("Cadastre a chave nos ajustes!");
        navigator.clipboard.writeText(c); alert("Chave copiada!");
    }

    function atualizarStatus() {
        const h = new Date().getHours();
        const a = parseInt(document.getElementById('cfgAbre').value) || 8;
        const f = parseInt(document.getElementById('cfgFecha').value) || 22;
        const s = document.getElementById('statusLoja');
        if(h >= a && h < f) { s.innerText = "‚óè ABERTA"; s.className = "status-badge open"; }
        else { s.innerText = "‚óè FECHADA"; s.className = "status-badge closed"; }
    }

    function gerarPIX() {
        const chave = document.getElementById('cfgPix').value;
        if(!chave) return alert("Cadastre a chave!");
        document.getElementById('areaPix').style.display = "block";
        const qr = document.getElementById('qrcode');
        qr.innerHTML = "";
        new QRCode(qr, { text: chave, width: 120, height: 120 });
    }

    function calcPDV() {
        const q = document.getElementById('qtdRobux').value;
        document.getElementById('taxPDV').innerText = `Gamepass Sugerida: ${Math.ceil(q / 0.7)} Robux`;
    }

    function copiarOrcamento() {
        const q = document.getElementById('simQtd').value;
        const v = document.getElementById('sPrecoCli').innerText;
        navigator.clipboard.writeText(`üíé *DNB STORE*\nüì¶ *${q} Robux*\nüí∞ *${v}*`);
        alert("Copiado!");
    }

    window.onload = loadCfg;
    setInterval(atualizarStatus, 60000);
</script>
</body>
</html>

