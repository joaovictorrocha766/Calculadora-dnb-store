<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNB STORE | Gest√£o Completa</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        :root {
            --bg: #0a0f1e; --card: #161e31; --primary: #3b82f6;
            --success: #22c55e; --text: #f8fafc; --purple: #8b5cf6; --danger: #ef4444; --warning: #f59e0b;
        }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); padding: 20px; display: flex; flex-direction: column; align-items: center; margin: 0; }
        .container { width: 100%; max-width: 650px; }
        
        .tabs { display: flex; gap: 8px; margin-bottom: 15px; width: 100%; }
        .tab-btn { flex: 1; padding: 12px; background: var(--card); border: 1px solid #2d3748; color: #94a3b8; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 0.8rem; }
        .tab-btn.active { background: var(--primary); color: white; }

        .card { background: var(--card); padding: 20px; border-radius: 16px; border: 1px solid #2d3748; margin-bottom: 15px; }
        .content-section { display: none; }
        .content-section.active { display: block; }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        label { display: block; font-size: 0.75rem; color: #94a3b8; margin-bottom: 4px; }
        input, select { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #2d3748; background: #0a0f1e; color: white; box-sizing: border-box; }
        
        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; margin-top: 8px; }
        .btn-success { background: var(--success); color: white; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-purple { background: var(--purple); color: white; }

        .caixa-box { background: #1e293b; border: 1px solid var(--primary); padding: 15px; border-radius: 12px; margin-bottom: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; text-align: center; }
        
        .simulacao-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #2d3748; font-size: 0.9rem; }
        .val-destaque { color: var(--success); font-weight: bold; }

        table { width: 100%; border-collapse: collapse; font-size: 0.8rem; margin-top: 10px; }
        th { text-align: left; color: #94a3b8; padding: 8px; border-bottom: 1px solid #2d3748; }
        td { padding: 8px; border-bottom: 1px solid #1a202c; }

        @media print { body * { visibility: hidden; } #pdfLayout, #pdfLayout * { visibility: visible; } #pdfLayout { display: block !important; position: absolute; left: 0; top: 0; width: 100%; color: black !important; } }
    </style>
</head>
<body>

<div class="container">
    <div class="tabs">
        <button class="tab-btn active" onclick="openTab('vendas')">üõí PDV</button>
        <button class="tab-btn" onclick="openTab('simula')">üßÆ Simula√ß√£o</button>
        <button class="tab-btn" onclick="openTab('busca')">üîç Auditoria</button>
        <button class="tab-btn" onclick="openTab('config')">‚öôÔ∏è Ajustes</button>
    </div>

    <div id="vendas" class="content-section active">
        <div class="card">
            <h2 style="margin:0 0 15px 0; color:var(--primary);">DNB STORE</h2>
            <div class="grid">
                <div><label>Cliente (@)</label><input type="text" id="nomeCliente" placeholder="Ex: @Marcos"></div>
                <div><label>Qtd Robux</label><input type="number" id="qtdRobux" oninput="calcularPDV()"></div>
            </div>
            <div id="taxRobloxPDV" style="background: rgba(245, 158, 11, 0.1); border: 1px solid #f59e0b; padding: 10px; border-radius: 8px; margin-bottom: 10px; text-align: center; color: #f59e0b; font-weight: bold; font-size: 0.8rem;">Gamepass Sugerida: 0</div>
            <select id="vendedor" style="margin-bottom: 10px;"><option value="Jo√£o">Vendedor: Jo√£o</option><option value="S√≥cio">Vendedor: S√≥cio</option></select>
            <button class="btn btn-success" onclick="salvarVenda()">üíæ SALVAR E COPIAR RECIBO</button>
        </div>

        <div class="caixa-box">
            <div style="grid-column: span 2;"><span style="font-size: 0.7rem; color: #94a3b8;">LUCRO L√çQUIDO ACUMULADO</span><br><span id="lucroTotal" style="color: var(--success); font-size: 1.5rem; font-weight: bold;">R$ 0,00</span></div>
            <div><span style="font-size: 0.7rem; color: #94a3b8;">JO√ÉO (50%)</span><br><span id="lJoao" style="color:var(--primary); font-weight:bold;">R$ 0,00</span></div>
            <div><span style="font-size: 0.7rem; color: #94a3b8;">S√ìCIO (50%)</span><br><span id="lSocio" style="color:var(--primary); font-weight:bold;">R$ 0,00</span></div>
        </div>
    </div>

    <div id="simula" class="content-section">
        <div class="card">
            <h3 style="color:var(--purple);">Calculadora de Or√ßamento</h3>
            <label>Quantidade de Robux desejada:</label>
            <input type="number" id="simQtd" placeholder="Ex: 1000" oninput="realizarSimulacao()">
            
            <div style="margin-top:20px;">
                <div class="simulacao-item"><span>Custo Fornecedor (0,0335):</span><span id="simCusto">R$ 0,00</span></div>
                <div class="simulacao-item"><span>Pre√ßo para o Cliente (0,0480):</span><span id="simVenda" class="val-destaque">R$ 0,00</span></div>
                <div class="simulacao-item"><span>Lucro Total Bruto:</span><span id="simLucro" style="color:var(--success)">R$ 0,00</span></div>
                <div class="simulacao-item" style="border:none; background:rgba(59,130,246,0.1); padding:10px; border-radius:8px; margin-top:10px;">
                    <span>Divis√£o (50% Jo√£o / 50% S√≥cio):</span>
                    <span id="simDivisao" style="font-weight:bold; color:var(--primary);">R$ 0,00 cada</span>
                </div>
            </div>
            <button class="btn btn-purple" onclick="copiarOrcamento()">üìã Copiar Or√ßamento p/ Cliente</button>
        </div>
    </div>

    <div id="busca" class="content-section">
        <div class="card">
            <h3>Rastrear Protocolo</h3>
            <input type="text" id="inputBusca" placeholder="DNB-XXXXXX" oninput="buscar()">
            <div id="areaBusca" style="display:none; margin-top:15px;">
                <div id="detalhesBusca" style="font-size:0.85rem; margin-bottom:15px;"></div>
                <button class="btn btn-primary" onclick="imprimir('empresa')">üìÑ PDF Auditoria</button>
                <button class="btn btn-warning" onclick="imprimir('cliente')">üë§ PDF Cliente</button>
            </div>
        </div>
    </div>

    <div id="config" class="content-section">
        <div class="card">
            <h3>Ajuste de Taxas</h3>
            <label>Custo Unit√°rio (Forn):</label><input type="number" id="confCusto" value="0.0335" step="0.0001">
            <label>Venda Unit√°ria (Loja):</label><input type="number" id="confVenda" value="0.0480" step="0.0001">
        </div>
        <button class="btn btn-primary" onclick="alert('Configura√ß√µes aplicadas!')">‚úÖ Salvar Taxas</button>
    </div>
</div>

<script>
    let vLocal = null;
    let prot = "";

    function openTab(id) {
        document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    // L√ìGICA DA SIMULA√á√ÉO
    function realizarSimulacao() {
        const qtd = parseFloat(document.getElementById('simQtd').value) || 0;
        const cUnit = parseFloat(document.getElementById('confCusto').value);
        const vUnit = parseFloat(document.getElementById('confVenda').value);

        const custo = (qtd * cUnit);
        const venda = (qtd * vUnit);
        const lucro = venda - custo;

        document.getElementById('simCusto').innerText = `R$ ${custo.toFixed(2)}`;
        document.getElementById('simVenda').innerText = `R$ ${venda.toFixed(2)}`;
        document.getElementById('simLucro').innerText = `R$ ${lucro.toFixed(2)}`;
        document.getElementById('simDivisao').innerText = `R$ ${(lucro/2).toFixed(2)} cada`;
    }

    function copiarOrcamento() {
        const qtd = document.getElementById('simQtd').value;
        const valor = document.getElementById('simVenda').innerText;
        if(!qtd) return alert("Insira uma quantidade!");
        const texto = `üíé *DNB STORE - OR√áAMENTO*\n\nüì¶ *PRODUTO:* ${qtd} Robux\nüí∞ *VALOR:* ${valor}\n\n‚úÖ *Garantia de entrega e suporte oficial.*`;
        navigator.clipboard.writeText(texto);
        alert("Or√ßamento copiado!");
    }

    // L√ìGICA PDV
    function calcularPDV() {
        const qtd = document.getElementById('qtdRobux').value;
        document.getElementById('taxRobloxPDV').innerText = `Gamepass Sugerida: ${Math.ceil(qtd / 0.7)} Robux`;
        prot = "DNB-" + Math.floor(100000 + Math.random() * 900000);
    }

    function salvarVenda() {
        const qtd = document.getElementById('qtdRobux').value;
        const cli = document.getElementById('nomeCliente').value || "Cliente";
        if(!qtd) return alert("Erro: Quantidade vazia");

        const custoU = parseFloat(document.getElementById('confCusto').value);
        const vendaU = parseFloat(document.getElementById('confVenda').value);

        const vTot = (qtd * vendaU).toFixed(2);
        const lTot = (vTot - (qtd * custoU)).toFixed(2);

        const venda = {
            prot, cli, v: document.getElementById('vendedor').value,
            qtd, vTot, lTot, cTot: (qtd * custoU).toFixed(2),
            data: new Date().toLocaleDateString(),
            hora: new Date().toLocaleTimeString()
        };

        let db = JSON.parse(localStorage.getItem('dnb_db')) || [];
        db.unshift(venda);
        localStorage.setItem('dnb_db', JSON.stringify(db));

        navigator.clipboard.writeText(`üíé *DNB STORE*\n\nüÜî *PROT:* ${prot}\nüë§ *CLIENTE:* ${cli}\nüì¶ *PRODUTO:* ${qtd} Robux\nüí∞ *VALOR:* R$ ${vTot}\n‚úÖ *STATUS:* CONCLU√çDO`);
        
        alert("Venda Salva e Recibo Copiado!");
        render();
        document.getElementById('qtdRobux').value = "";
        calcularPDV();
    }

    function render() {
        const db = JSON.parse(localStorage.getItem('dnb_db')) || [];
        let totalL = 0;
        db.forEach(v => totalL += parseFloat(v.lTot));
        document.getElementById('lucroTotal').innerText = `R$ ${totalL.toFixed(2)}`;
        document.getElementById('lJoao').innerText = `R$ ${(totalL/2).toFixed(2)}`;
        document.getElementById('lSocio').innerText = `R$ ${(totalL/2).toFixed(2)}`;
    }

    function buscar() {
        const b = document.getElementById('inputBusca').value.toUpperCase();
        const db = JSON.parse(localStorage.getItem('dnb_db')) || [];
        vLocal = db.find(v => v.prot === b);
        document.getElementById('areaBusca').style.display = vLocal ? "block" : "none";
        if(vLocal) document.getElementById('detalhesBusca').innerHTML = `<b>Cliente:</b> ${vLocal.cli} | <b>Valor:</b> R$ ${vLocal.vTot}`;
    }

    render();
</script>
</body>
</html>

