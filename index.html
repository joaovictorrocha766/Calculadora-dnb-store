<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNB STORE | Gest√£o Oficial</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        :root {
            --bg: #0a0f1e; --card: #161e31; --primary: #3b82f6;
            --success: #22c55e; --text: #f8fafc; --purple: #8b5cf6; --danger: #ef4444; --warning: #f59e0b;
        }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); padding: 15px; display: flex; flex-direction: column; align-items: center; margin: 0; }
        .container { width: 100%; max-width: 650px; }
        
        .tabs { display: flex; gap: 5px; margin-bottom: 15px; width: 100%; overflow-x: auto; padding: 5px; scrollbar-width: none; }
        .tab-btn { flex: 1; padding: 10px; background: var(--card); border: 1px solid #2d3748; color: #94a3b8; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 0.7rem; white-space: nowrap; }
        .tab-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

        .card { background: var(--card); padding: 20px; border-radius: 16px; border: 1px solid #2d3748; margin-bottom: 15px; }
        .content-section { display: none; }
        .content-section.active { display: block; }

        .status-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; width: 100%; }
        .status-badge { padding: 6px 12px; border-radius: 20px; font-size: 0.65rem; font-weight: bold; }
        .open { background: rgba(34, 197, 94, 0.2); color: var(--success); border: 1px solid var(--success); }
        .closed { background: rgba(239, 68, 68, 0.2); color: var(--danger); border: 1px solid var(--danger); }

        .estoque-banner { padding: 10px; border-radius: 8px; text-align: center; font-size: 0.8rem; margin-bottom: 15px; font-weight: bold; }
        .estoque-ok { background: rgba(59, 130, 246, 0.1); color: var(--primary); border: 1px solid var(--primary); }
        .estoque-baixo { background: rgba(239, 68, 68, 0.2); color: var(--danger); border: 1px solid var(--danger); animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }

        label { display: block; font-size: 0.75rem; color: #94a3b8; margin-bottom: 5px; }
        input { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #2d3748; background: #0a0f1e; color: white; margin-bottom: 15px; box-sizing: border-box; }
        
        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 5px; }
        .btn-success { background: var(--success); color: white; }
        .btn-purple { background: var(--purple); color: white; }
        .btn-primary { background: var(--primary); color: white; }

        .caixa-resumo { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; background: #1e293b; padding: 15px; border-radius: 12px; text-align: center; margin-top: 10px; }
        
        table { width: 100%; font-size: 0.75rem; color: #cbd5e1; border-collapse: collapse; margin-top: 10px; }
        th { text-align: left; color: #94a3b8; padding: 8px; border-bottom: 1px solid #2d3748; }
        td { padding: 8px; border-bottom: 1px solid #1a202c; }

        .msg-item { background: #0a0f1e; border: 1px solid #2d3748; padding: 12px; border-radius: 10px; margin-bottom: 10px; }
        .msg-item p { font-size: 0.8rem; margin: 0 0 10px 0; color: #cbd5e1; }

        #qrcode { background: white; padding: 10px; border-radius: 8px; display: inline-block; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <div class="status-header">
        <div style="font-weight: bold; font-size: 1.1rem;">DNB STORE üíé</div>
        <div id="statusLoja" class="status-badge">Verificando...</div>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="openTab('vendas')">üõí PDV</button>
        <button class="tab-btn" onclick="openTab('simulacao')">üßÆ SIMULA√á√ÉO</button>
        <button class="tab-btn" onclick="openTab('mensagens')">üì¢ MSGS</button>
        <button class="tab-btn" onclick="openTab('relatorios')">üìä RELAT√ìRIOS</button>
        <button class="tab-btn" onclick="openTab('ajustes')">‚öôÔ∏è AJUSTES</button>
    </div>

    <div id="vendas" class="content-section active">
        <div id="bannerEstoque" class="estoque-banner estoque-ok">Saldo no Fornecedor: 0 Robux</div>
        <div class="card">
            <label>Cliente (@)</label>
            <input type="text" id="nomeCliente" placeholder="Ex: @Marcos_Roblox">
            <label>Quantidade de Robux</label>
            <input type="number" id="qtdRobux" oninput="calcPDV()">
            <div id="taxPDV" style="text-align:center; color:var(--warning); font-weight:bold; font-size:0.8rem; margin-bottom:15px;">Gamepass: 0</div>
            <button class="btn btn-success" onclick="salvarVenda()">üíæ SALVAR E COPIAR RECIBO</button>
            <button class="btn btn-primary" onclick="gerarPIX()">üì± GERAR QR CODE PIX</button>
            <div id="areaPix" style="display:none; text-align:center; margin-top:15px;">
                <div id="qrcode"></div>
                <p style="font-size:0.7rem; color:var(--warning); margin-top:5px;">Aponte a c√¢mera para o QR Code</p>
            </div>
        </div>
        <div class="caixa-resumo">
            <div style="grid-column: span 2; border-bottom: 1px solid #334155; padding-bottom: 8px;">
                <label>LUCRO TOTAL ACUMULADO</label><span id="lucroAcumulado" style="font-size: 1.4rem; font-weight: bold; color: var(--success);">R$ 0,00</span>
            </div>
            <div><label>EU (50%)</label><span id="lEu" style="color:var(--primary); font-weight:bold;">R$ 0,00</span></div>
            <div><label>S√ìCIO (50%)</label><span id="lSocio" style="color:var(--primary); font-weight:bold;">R$ 0,00</span></div>
        </div>
    </div>

    <div id="simulacao" class="content-section">
        <div class="card">
            <h3>üßÆ Calculadoras</h3>
            <label>Simular por Quantidade de Robux:</label>
            <input type="number" id="simQtd" placeholder="Ex: 1000" oninput="realizarSimulacao()">
            
            <hr style="border:0; border-top:1px solid #2d3748; margin:20px 0;">
            
            <label>Calculadora Reversa (Valor da Gamepass):</label>
            <input type="number" id="simRev" placeholder="Ex: 800" oninput="realizarReversa()">
            
            <div id="resSimula" style="background: #0a0f1e; padding: 15px; border-radius: 10px; font-size: 0.9rem;">
                <p>O Cliente Recebe: <span id="sVenda" style="float:right; color:var(--success); font-weight:bold;">0 Robux</span></p>
                <p>Pre√ßo para o Cliente: <span id="sPrecoCli" style="float:right">R$ 0,00</span></p>
                <p>Seu Lucro Estimado: <span id="sLucro" style="float:right">R$ 0,00</span></p>
            </div>
            <button class="btn btn-purple" style="margin-top:15px;" onclick="copiarOrcamento()">üìã COPIAR OR√áAMENTO</button>
        </div>
    </div>

    <div id="mensagens" class="content-section">
        <div class="card">
            <div class="msg-item"><p><strong>üåô Hor√°rio Fechado</strong></p><button class="btn btn-primary" onclick="copiarMsg('fechado')">Copiar</button></div>
            <div class="msg-item"><p><strong>‚è≥ Aguardando PIX</strong></p><button class="btn btn-primary" onclick="copiarMsg('pix')">Copiar</button></div>
            <div class="msg-item"><p><strong>‚è≥ Explica√ß√£o Pendente</strong></p><button class="btn btn-primary" onclick="copiarMsg('pendente')">Copiar</button></div>
        </div>
    </div>

    <div id="relatorios" class="content-section">
        <div class="card">
            <h3>üìä Desempenho Mensal</h3>
            <table id="tabelaMensal">
                <thead><tr><th>M√™s/Ano</th><th>Vendas</th><th>Lucro Total</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <div id="ajustes" class="content-section">
        <div class="card">
            <h3>‚öôÔ∏è Configura√ß√µes Base</h3>
            <label>Chave PIX (Para o QR Code):</label>
            <input type="text" id="cfgPix" placeholder="E-mail, CPF ou Telefone" oninput="saveCfg()">
            <label>Custo Unit√°rio:</label><input type="number" id="cfgCusto" value="0.0335" step="0.0001" oninput="saveCfg()">
            <label>Venda Unit√°ria:</label><input type="number" id="cfgVenda" value="0.0480" step="0.0001" oninput="saveCfg()">
            <label>Saldo no Fornecedor:</label><input type="number" id="cfgEstoque" value="0" oninput="saveCfg()">
            <div style="display:flex; gap:10px;">
                <div style="flex:1"><label>Abre:</label><input type="number" id="cfgAbre" value="8" oninput="saveCfg()"></div>
                <div style="flex:1"><label>Fecha:</label><input type="number" id="cfgFecha" value="22" oninput="saveCfg()"></div>
            </div>
        </div>
        <div class="card">
            <h3>üèÜ Fidelidade</h3>
            <table id="tabelaFidelidade">
                <thead><tr><th>Cliente</th><th>Total</th><th>Pontos</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
        <button class="btn btn-danger" onclick="localStorage.clear(); location.reload();">üóëÔ∏è RESETAR SISTEMA</button>
    </div>
</div>

<script>
    function openTab(id) {
        document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    function saveCfg() {
        const config = {
            custo: document.getElementById('cfgCusto').value,
            venda: document.getElementById('cfgVenda').value,
            abre: document.getElementById('cfgAbre').value,
            fecha: document.getElementById('cfgFecha').value,
            estoque: document.getElementById('cfgEstoque').value,
            pix: document.getElementById('cfgPix').value
        };
        localStorage.setItem('dnb_config', JSON.stringify(config));
        atualizarStatus();
    }

    function loadCfg() {
        const c = JSON.parse(localStorage.getItem('dnb_config'));
        if(c) {
            document.getElementById('cfgCusto').value = c.custo || 0.0335;
            document.getElementById('cfgVenda').value = c.venda || 0.0480;
            document.getElementById('cfgAbre').value = c.abre || 8;
            document.getElementById('cfgFecha').value = c.fecha || 22;
            document.getElementById('cfgEstoque').value = c.estoque || 0;
            document.getElementById('cfgPix').value = c.pix || "";
        }
        renderTudo();
    }

    function renderTudo() {
        renderFinancas();
        renderFidelidade();
        renderEstoque();
        renderMensal();
    }

    function renderEstoque() {
        const est = parseInt(document.getElementById('cfgEstoque').value) || 0;
        const b = document.getElementById('bannerEstoque');
        b.innerText = `Saldo no Fornecedor: ${est.toLocaleString()} Robux`;
        b.className = est < 1000 ? "estoque-banner estoque-baixo" : "estoque-banner estoque-ok";
    }

    function realizarSimulacao() {
        const qtd = parseFloat(document.getElementById('simQtd').value) || 0;
        const vU = parseFloat(document.getElementById('cfgVenda').value);
        const cU = parseFloat(document.getElementById('cfgCusto').value);
        document.getElementById('sVenda').innerText = `${qtd} Robux`;
        document.getElementById('sPrecoCli').innerText = `R$ ${(qtd * vU).toFixed(2)}`;
        document.getElementById('sLucro').innerText = `R$ ${(qtd * (vU - cU)).toFixed(2)}`;
    }

    function realizarReversa() {
        const pass = parseFloat(document.getElementById('simRev').value) || 0;
        const recebe = Math.floor(pass * 0.7);
        const vU = parseFloat(document.getElementById('cfgVenda').value);
        const cU = parseFloat(document.getElementById('cfgCusto').value);
        document.getElementById('sVenda').innerText = `${recebe} Robux`;
        document.getElementById('sPrecoCli').innerText = `R$ ${(recebe * vU).toFixed(2)}`;
        document.getElementById('sLucro').innerText = `R$ ${(recebe * (vU - cU)).toFixed(2)}`;
    }

    function salvarVenda() {
        const qtd = parseFloat(document.getElementById('qtdRobux').value);
        const cli = document.getElementById('nomeCliente').value || "Cliente";
        let est = parseInt(document.getElementById('cfgEstoque').value);
        if(!qtd || qtd > est) return alert("Erro: Quantidade inv√°lida ou sem estoque!");

        const cU = parseFloat(document.getElementById('cfgCusto').value);
        const vU = parseFloat(document.getElementById('cfgVenda').value);
        const vTot = (qtd * vU).toFixed(2);
        const lTot = (vTot - (qtd * cU)).toFixed(2);
        
        const db = JSON.parse(localStorage.getItem('dnb_db')) || [];
        db.unshift({ cli, qtd, vTot, lTot, date: new Date().toISOString() });
        localStorage.setItem('dnb_db', JSON.stringify(db));

        document.getElementById('cfgEstoque').value = est - qtd;
        saveCfg();
        document.getElementById('qtdRobux').value = "";
        renderTudo();
        alert("Venda Registrada!");
    }

    function renderMensal() {
        const db = JSON.parse(localStorage.getItem('dnb_db')) || [];
        const mensal = {};
        db.forEach(v => {
            const d = new Date(v.date);
            const key = `${d.getMonth()+1}/${d.getFullYear()}`;
            if(!mensal[key]) mensal[key] = { q: 0, l: 0 };
            mensal[key].q++; mensal[key].l += parseFloat(v.lTot);
        });
        const tbody = document.querySelector("#tabelaMensal tbody");
        tbody.innerHTML = "";
        for(let k in mensal) {
            tbody.innerHTML += `<tr><td>${k}</td><td>${mensal[k].q}</td><td style="color:var(--success)">R$ ${mensal[k].l.toFixed(2)}</td></tr>`;
        }
    }

    function gerarPIX() {
        const chave = document.getElementById('cfgPix').value;
        if(!chave) return alert("Configure sua chave PIX nos Ajustes primeiro!");
        document.getElementById('areaPix').style.display = "block";
        const qrDiv = document.getElementById('qrcode');
        qrDiv.innerHTML = "";
        new QRCode(qrDiv, { text: chave, width: 128, height: 128 });
    }

    // Fun√ß√µes de apoio (Finan√ßas, Fidelidade, Status, Mensagens) permanecem as mesmas logicamente
    function renderFinancas() {
        const db = JSON.parse(localStorage.getItem('dnb_db')) || [];
        let t = 0; db.forEach(v => t += parseFloat(v.lTot));
        document.getElementById('lucroAcumulado').innerText = `R$ ${t.toFixed(2)}`;
        document.getElementById('lEu').innerText = `R$ ${(t/2).toFixed(2)}`;
        document.getElementById('lSocio').innerText = `R$ ${(t/2).toFixed(2)}`;
    }
    function renderFidelidade() {
        const db = JSON.parse(localStorage.getItem('dnb_db')) || [];
        const pts = {};
        db.forEach(v => { const n = v.cli.toLowerCase(); pts[n] = (pts[n] || 0) + parseFloat(v.qtd); });
        const tbody = document.querySelector("#tabelaFidelidade tbody");
        tbody.innerHTML = "";
        for(let n in pts) tbody.innerHTML += `<tr><td>${n}</td><td>${pts[n]}</td><td>${Math.floor(pts[n]/1000)} pts</td></tr>`;
    }
    function atualizarStatus() {
        const h = new Date().getHours();
        const a = parseInt(document.getElementById('cfgAbre').value);
        const f = parseInt(document.getElementById('cfgFecha').value);
        const s = document.getElementById('statusLoja');
        if(h >= a && h < f) { s.innerText = "‚óè ABERTA"; s.className = "status-badge open"; }
        else { s.innerText = "‚óè FECHADA"; s.className = "status-badge closed"; }
    }
    function calcPDV() {
        const q = document.getElementById('qtdRobux').value;
        document.getElementById('taxPDV').innerText = `Gamepass Sugerida: ${Math.ceil(q / 0.7)} Robux`;
    }
    function copiarMsg(tipo) {
        let t = ""; const a = document.getElementById('cfgAbre').value;
        if(tipo === 'fechado') t = `üåô *DNB STORE*\n\nSetor de entregas pausado. Seu pedido ser√° enviado √†s *${a}:00h*!`;
        if(tipo === 'pix') t = `‚è≥ *DNB STORE*\n\nAguardamos o comprovante para liberar seu pedido!`;
        if(tipo === 'pendente') t = `‚è≥ *SOBRE O PRAZO*\n\nRobux via Gamepass ficam 'Pendentes' por *3 a 7 dias*. √â o padr√£o do Roblox!`;
        navigator.clipboard.writeText(t); alert("Copiado!");
    }
    function copiarOrcamento() {
        const q = document.getElementById('sVenda').innerText;
        const v = document.getElementById('sPrecoCli').innerText;
        navigator.clipboard.writeText(`üíé *DNB STORE - OR√áAMENTO*\n\nüì¶ *PRODUTO:* ${q}\nüí∞ *VALOR:* ${v}\n\n‚úÖ *Entrega garantida!*`);
        alert("Copiado!");
    }

    window.onload = loadCfg;
    setInterval(atualizarStatus, 60000);
</script>
</body>
</html>

