<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNB STORE | Sistema Profissional</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        :root {
            --bg: #0a0f1e; --card: #161e31; --primary: #3b82f6;
            --success: #22c55e; --text: #f8fafc; --purple: #8b5cf6; --danger: #ef4444; --warning: #f59e0b;
        }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); padding: 20px; display: flex; flex-direction: column; align-items: center; margin: 0; }
        .container { width: 100%; max-width: 650px; }
        
        .tabs { display: flex; gap: 8px; margin-bottom: 15px; width: 100%; }
        .tab-btn { flex: 1; padding: 12px; background: var(--card); border: 1px solid #2d3748; color: #94a3b8; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .tab-btn.active { background: var(--primary); color: white; }

        .card { background: var(--card); padding: 20px; border-radius: 16px; border: 1px solid #2d3748; margin-bottom: 15px; }
        .content-section { display: none; }
        .content-section.active { display: block; }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        label { display: block; font-size: 0.75rem; color: #94a3b8; margin-bottom: 4px; }
        input, select { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #2d3748; background: #0a0f1e; color: white; box-sizing: border-box; }
        
        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; margin-top: 8px; }
        .btn-success { background: var(--success); color: white; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-danger { background: var(--danger); color: white; margin-top: 15px; font-size: 0.7rem; }

        .caixa-box { background: #1e293b; border: 1px solid var(--primary); padding: 15px; border-radius: 12px; margin-bottom: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; text-align: center; }
        
        table { width: 100%; border-collapse: collapse; font-size: 0.8rem; margin-top: 10px; }
        th { text-align: left; color: #94a3b8; padding: 8px; border-bottom: 1px solid #2d3748; }
        td { padding: 8px; border-bottom: 1px solid #1a202c; }

        /* PDF oculto */
        #pdfLayout { display: none; background: white !important; color: black !important; padding: 40px; }
        @media print {
            body * { visibility: hidden; }
            #pdfLayout, #pdfLayout * { visibility: visible; }
            #pdfLayout { display: block !important; position: absolute; left: 0; top: 0; width: 100%; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="tabs">
        <button class="tab-btn active" onclick="openTab('vendas')">üõí PDV</button>
        <button class="tab-btn" onclick="openTab('busca')">üîç Auditoria</button>
        <button class="tab-btn" onclick="openTab('config')">‚öôÔ∏è Ajustes</button>
    </div>

    <div id="vendas" class="content-section active">
        <div class="card">
            <h2 style="margin:0 0 15px 0; color:var(--primary);">DNB STORE</h2>
            <div class="grid">
                <div><label>Cliente (@)</label><input type="text" id="nomeCliente" placeholder="Ex: @Marcos"></div>
                <div><label>Qtd Robux</label><input type="number" id="qtdRobux" oninput="calcular()"></div>
            </div>
            <div id="taxRoblox" style="background: rgba(245, 158, 11, 0.1); border: 1px solid #f59e0b; padding: 10px; border-radius: 8px; margin-bottom: 10px; text-align: center; color: #f59e0b; font-weight: bold;">Gamepass: 0</div>
            
            <select id="vendedor" style="margin-bottom: 10px;"><option value="Jo√£o">Vendedor: Jo√£o</option><option value="S√≥cio">Vendedor: S√≥cio</option></select>
            
            <button class="btn btn-success" onclick="salvarVenda()">üíæ SALVAR E COPIAR RECIBO</button>
        </div>

        <div class="caixa-box">
            <div style="grid-column: span 2;"><span style="font-size: 0.7rem; color: #94a3b8;">LUCRO L√çQUIDO ACUMULADO</span><br><span id="lucroTotal" style="color: var(--success); font-size: 1.5rem; font-weight: bold;">R$ 0,00</span></div>
            <div><span style="font-size: 0.7rem; color: #94a3b8;">JO√ÉO (50%)</span><br><span id="lJoao" style="color:var(--primary); font-weight:bold;">R$ 0,00</span></div>
            <div><span style="font-size: 0.7rem; color: #94a3b8;">S√ìCIO (50%)</span><br><span id="lSocio" style="color:var(--primary); font-weight:bold;">R$ 0,00</span></div>
        </div>

        <div class="card" style="padding:10px;">
            <h4 style="margin:5px;">Vendas Recentes</h4>
            <table id="tabelaVendas">
                <thead><tr><th>Protocolo</th><th>Cliente</th><th>Valor</th><th>Vendedor</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <div id="busca" class="content-section">
        <div class="card">
            <h3>Rastrear Venda</h3>
            <input type="text" id="inputBusca" placeholder="DNB-XXXXXX" oninput="buscar()">
            <div id="areaBusca" style="display:none; margin-top:15px;">
                <div id="detalhesBusca" style="font-size:0.85rem; margin-bottom:15px; border-left: 3px solid var(--primary); padding-left:10px;"></div>
                <button class="btn btn-purple" onclick="imprimir('empresa')">üìÑ Gerar PDF Auditoria</button>
                <button class="btn btn-warning" onclick="imprimir('cliente')">üë§ Gerar PDF Cliente</button>
            </div>
        </div>
    </div>

    <div id="config" class="content-section">
        <div class="card">
            <h3>Ajuste de Pre√ßos (Unidade)</h3>
            <label>Custo do Fornecedor (R$ por 1 Robux)</label>
            <input type="number" id="confCusto" value="0.0335" step="0.0001">
            <label>Pre√ßo de Venda (R$ por 1 Robux)</label>
            <input type="number" id="confVenda" value="0.0480" step="0.0001">
            <p style="font-size:0.7rem; color:#94a3b8;">* Esses valores alteram o c√°lculo do lucro 50/50.</p>
        </div>
        <button class="btn btn-danger" onclick="localStorage.clear(); location.reload();">üóëÔ∏è RESETAR SISTEMA</button>
    </div>
</div>

<div id="pdfLayout">
    <h2 id="pdfTit" style="text-align:center; border-bottom: 2px solid #000;"></h2>
    <div id="pdfCorpo"></div>
    <div id="pdfAudit" style="margin-top:20px; background:#eee; padding:10px; display:none;">
        <h4>DIVIS√ÉO DE LUCRO</h4>
        <p id="pAuditData"></p>
    </div>
    <div style="margin-top:20px; font-size:10px; border-top:1px solid #000;">
        <b>DNB STORE:</b> Prazo 3-7 dias (Roblox). Sem reembolsos ap√≥s envio.
    </div>
    <div style="display:flex; justify-content:center; margin-top:20px;"><div id="qrcode"></div></div>
</div>

<script>
    let vLocal = null;
    let prot = "";
    let hash = "";

    function openTab(id) {
        document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    function calcular() {
        const qtd = document.getElementById('qtdRobux').value;
        document.getElementById('taxRoblox').innerText = `Gamepass Sugerida: ${Math.ceil(qtd / 0.7)} Robux`;
        prot = "DNB-" + Math.floor(100000 + Math.random() * 900000);
        hash = "SIG-" + Math.random().toString(36).substring(2, 10).toUpperCase();
    }

    function salvarVenda() {
        const qtd = document.getElementById('qtdRobux').value;
        const cli = document.getElementById('nomeCliente').value || "Cliente";
        if(!qtd) return alert("Erro: Quantidade vazia");

        const custoU = parseFloat(document.getElementById('confCusto').value);
        const vendaU = parseFloat(document.getElementById('confVenda').value);

        const vTot = (qtd * vendaU).toFixed(2);
        const cTot = (qtd * custoU).toFixed(2);
        const lTot = (vTot - cTot).toFixed(2);

        const venda = {
            prot, hash, cli, v: document.getElementById('vendedor').value,
            qtd, vTot, cTot, lTot,
            data: new Date().toLocaleDateString(),
            hora: new Date().toLocaleTimeString()
        };

        let db = JSON.parse(localStorage.getItem('dnb_db')) || [];
        db.unshift(venda);
        localStorage.setItem('dnb_db', JSON.stringify(db));

        // COPIAR COMPROVANTE AUTOM√ÅTICO
        const texto = `üíé *DNB STORE*\n\nüÜî *PROT:* ${prot}\nüë§ *CLIENTE:* ${cli}\nüì¶ *PRODUTO:* ${qtd} Robux\nüí∞ *VALOR:* R$ ${vTot}\n‚úÖ *STATUS:* CONCLU√çDO\n\nüõ°Ô∏è _O PDF oficial pode ser solicitado ao vendedor!_`;
        navigator.clipboard.writeText(texto);
        
        alert("Venda Salva! Recibo copiado para o WhatsApp.");
        render();
        document.getElementById('qtdRobux').value = "";
        calcular();
    }

    function render() {
        const db = JSON.parse(localStorage.getItem('dnb_db')) || [];
        let totalL = 0;
        const tbody = document.querySelector("#tabelaVendas tbody");
        tbody.innerHTML = "";

        db.forEach((v, i) => {
            if(i < 5) {
                tbody.innerHTML += `<tr><td>${v.prot}</td><td>${v.cli}</td><td>R$ ${v.vTot}</td><td>${v.v}</td></tr>`;
            }
            totalL += parseFloat(v.lTot);
        });

        document.getElementById('lucroTotal').innerText = `R$ ${totalL.toFixed(2)}`;
        document.getElementById('lJoao').innerText = `R$ ${(totalL/2).toFixed(2)}`;
        document.getElementById('lSocio').innerText = `R$ ${(totalL/2).toFixed(2)}`;
    }

    function buscar() {
        const b = document.getElementById('inputBusca').value.toUpperCase();
        const db = JSON.parse(localStorage.getItem('dnb_db')) || [];
        vLocal = db.find(v => v.prot === b);

        if(vLocal) {
            document.getElementById('areaBusca').style.display = "block";
            document.getElementById('detalhesBusca').innerHTML = `<b>Cliente:</b> ${vLocal.cli}<br><b>Data:</b> ${vLocal.data}<br><b>Total:</b> R$ ${vLocal.vTot}`;
        } else {
            document.getElementById('areaBusca').style.display = "none";
        }
    }

    function imprimir(tipo) {
        document.getElementById('pdfTit').innerText = tipo === 'empresa' ? "AUDITORIA INTERNA" : "RECIBO DO CLIENTE";
        document.getElementById('pdfAudit').style.display = tipo === 'empresa' ? "block" : "none";
        
        document.getElementById('pdfCorpo').innerHTML = `
            <p><b>Protocolo:</b> ${vLocal.prot}</p>
            <p><b>Cliente:</b> ${vLocal.cli}</p>
            <p><b>Produto:</b> ${vLocal.qtd} Robux</p>
            <p><b>Valor Pago:</b> R$ ${vLocal.vTot}</p>
            <p><b>Data:</b> ${vLocal.data} - ${vLocal.hora}</p>
        `;

        if(tipo === 'empresa') {
            document.getElementById('pAuditData').innerHTML = `
                Lucro Bruto: R$ ${vLocal.lTot}<br>
                <b>Jo√£o: R$ ${(vLocal.lTot/2).toFixed(2)}</b><br>
                <b>S√≥cio: R$ ${(vLocal.lTot/2).toFixed(2)}</b>
            `;
        }

        document.getElementById('qrcode').innerHTML = "";
        new QRCode(document.getElementById("qrcode"), { text: vLocal.prot, width: 100, height: 100 });
        
        setTimeout(() => window.print(), 500);
    }

    render();
    calcular();
</script>
</body>
</html>

